<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style1.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <title>EWMS Login</title>
</head>
<body>
    <div class="wrapper">
        <form onsubmit="return validationform()">
            <h1>Login</h1>

            <div class="input-box">
                <input type="text" id="user" placeholder="Username" required>
                <i class='bx bxs-user' style='color:#ffffff' ></i>
            </div>
            <div class="input-box">
                <input type="password"id="pass" placeholder="Password" required>
                <i class='bx bxs-lock-alt'></i>
            </div>
            <div class="remember-forgot">
                <label><input type="checkbox">Remember Me</label>
                <a href="#">Forgot Password</a>
            </div>
            <button type="submit" class="btn">Login</button>
            <br>
            <span id="error" style="color: rgb(9, 9, 9);"></span>
        </form>
        <script>
            function validationform(){
                //Credentials validation....
           let uname= document.getElementById("user").value;
           let pwd= document.getElementById("pass").value;
           let err=document.getElementById("error");
           if (uname.length!==8) {
            err.innerHTML="Invalid Username";return false;
           }  
           else if(uname.charAt(0)!=='R'||uname.charAt(1)!=='-'){
            err.innerHTML="Invalid Username";return false;
           }
           else {
             
              for(let i=2;i<8;i++){
                if(isNaN(uname.charAt(i))){
                   err.innerHTML="Invalid Username";
                   return false;
                }
              }
             }
           
           

           if(pwd.length<8 || pwd.length>13){
              err.innerHTML="Invalid password"; return false ;
           }
           else{
            let r = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[\W_]).*$/;
            if(! r.test(pwd)){
               err.innerHTML="Invalid password";return false ;
            }
           }
  // verification of credentials...

  fetch('http://localhost:3000/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username: uname, password: pwd })
                })

                // processing response...
                .then(response => response.json())
                .then(data => {
                    if (data.message === 'Login successful') {
                        let x=uname;let y="No";
                        if(data.fill>20.0){
                            y=uname;
                        }
                        window.location.href = `index2.html?fill=${y}`;  
                    } else {
                        err.innerHTML = data.message;  
                    }
                })
                
                // error handling...
                .catch(error => {
                    console.error('Error:', error);
                    err.innerHTML = "Error connecting to the server";  
                });
            //fetch request for retrieving fill level...
            
                return false;
            }
        </script>
    </div>
</body>
</html>